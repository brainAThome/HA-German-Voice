# ================================================================================
# HA-GERMAN-VOICE - Radio Intent Scripts
# ================================================================================
# Spielt Internet-Radio-Streams auf dem VACA Media Player (Echo Show 5)
# Streams werden direkt über media_player.play_media abgespielt
# ================================================================================

# ============================================================================
# Sender → Stream-URL Mapping (als Jinja-Macro)
# ============================================================================
# Die URLs werden in den Intent-Scripts per Jinja-Template aufgelöst.
# Format: Sendername → HLS/MP3 Stream URL
#
# Hinweis: Die Streams sind redaktionell kuratiert und getestet.
# Falls ein Stream nicht mehr funktioniert, URL hier aktualisieren.
# ============================================================================

RadioPlay:
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.spotify_ducking_active
  - service: input_text.set_value
    target:
      entity_id: input_text.radio_current_station
    data:
      value: "{{ radio_station }}"
  - service: media_player.play_media
    target:
      entity_id: media_player.vaca_362812d56_mediaplayer
    data:
      media_content_type: music
      media_content_id: >
        {% set stations = {
          "SWR3": "https://liveradio.swr.de/sw282p3/swr3/play.mp3",
          "SWR1": "https://liveradio.swr.de/sw282p3/swr1bw/play.mp3",
          "SWR2": "https://liveradio.swr.de/sw282p3/swr2/play.mp3",
          "WDR2": "https://wdr-wdr2-rheinland.icecastssl.wdr.de/wdr/wdr2/rheinland/mp3/128/stream.mp3",
          "1LIVE": "https://wdr-1live-live.icecastssl.wdr.de/wdr/1live/live/mp3/128/stream.mp3",
          "WDR5": "https://wdr-wdr5-live.icecastssl.wdr.de/wdr/wdr5/live/mp3/128/stream.mp3",
          "Bayern3": "https://streams.br.de/bayern3_2.m3u8",
          "Bayern1": "https://streams.br.de/bayern1_2.m3u8",
          "NDR2": "https://www.ndr.de/resources/metadaten/audio_ssl/livestream/ndr2.m3u",
          "HR3": "https://hr-hr3-live.sslcast.addradio.de/hr/hr3/live/mp3/128/stream.mp3",
          "AntenneBayern": "https://stream.antenne.de/antenne/stream/mp3",
          "RadioBob": "https://streams.radiobob.de/bob-live/mp3-192/mediaplayer",
          "RockAntenne": "https://stream.rockantenne.de/rockantenne/stream/mp3",
          "SunshineLive": "https://stream.sunshine-live.de/live/mp3-192/stream.mp3",
          "Fritz": "https://dispatcher.rndfnk.com/rbb/fritz/live/mp3/mid",
          "DLF": "https://st01.sslstream.dlf.de/dlf/01/128/mp3/stream.mp3",
          "DLFKultur": "https://st02.sslstream.dlf.de/dlf/02/128/mp3/stream.mp3",
          "Energy": "https://frontend.2.static.ert.hd-livestream.de/out/swr/swr_s01/default/11/hls/index_1.m3u8",
          "BigFM": "https://streams.bigfm.de/bigfm-deutschland-128-mp3",
          "KlassikRadio": "https://stream.klassikradio.de/live/mp3-192/stream.mp3",
          "Radio7": "https://stream.radio7.de/radio7/mp3-128/stream.mp3",
          "OE3": "https://orf-live.ors-shoutcast.at/oe3-q2a",
          "FIP": "https://icecast.radiofrance.fr/fip-midfi.mp3",
          "SwissJazz": "https://stream.srg-ssr.ch/m/rsj/mp3_128",
          "LoungeFM": "https://stream.lounge.fm/",
          "AbsolutRelax": "https://stream.absolutradio.de/absolut-relax/mp3-192/stream.mp3",
          "PlanetRadio": "https://planetradio.streamabc.net/planetradio-hqlivestream-mp3"
        } %}{{ stations.get(radio_station, stations["SWR3"]) }}
  - service: view_assist.navigate
    data:
      device: sensor.quasselbuechse
      path: /view-assist/music
      revert_timeout: 3600
  speech:
    text: >
      {% set display_names = {
        "SWR3": "SWR 3",
        "SWR1": "SWR 1",
        "SWR2": "SWR 2",
        "WDR2": "WDR 2",
        "1LIVE": "1Live",
        "WDR5": "WDR 5",
        "Bayern3": "Bayern 3",
        "Bayern1": "Bayern 1",
        "NDR2": "NDR 2",
        "HR3": "HR 3",
        "AntenneBayern": "Antenne Bayern",
        "RadioBob": "Radio Bob",
        "RockAntenne": "Rock Antenne",
        "SunshineLive": "Sunshine Live",
        "Fritz": "Fritz",
        "DLF": "Deutschlandfunk",
        "DLFKultur": "Deutschlandfunk Kultur",
        "Energy": "Energy",
        "BigFM": "Big FM",
        "KlassikRadio": "Klassik Radio",
        "Radio7": "Radio 7",
        "OE3": "Ö 3",
        "FIP": "FIP",
        "SwissJazz": "Swiss Jazz",
        "LoungeFM": "Lounge FM",
        "AbsolutRelax": "Absolut Relax",
        "PlanetRadio": "Planet Radio"
      } %}
      {% set name = display_names.get(radio_station, radio_station) %}
      {% set responses = [
        "OK, " ~ name ~ " läuft.",
        "Alles klar, ich schalte " ~ name ~ " ein.",
        name ~ " wird gestartet.",
        "Verstanden, " ~ name ~ " kommt."
      ] %} {{ responses | random }}

RadioPlayGenre:
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.spotify_ducking_active
  - service: input_text.set_value
    target:
      entity_id: input_text.radio_current_station
    data:
      value: >
        {% set genre_map = {
          "rock": "RadioBob",
          "pop": "SWR3",
          "jazz": "SwissJazz",
          "klassik": "KlassikRadio",
          "chill": "LoungeFM",
          "electronic": "SunshineLive",
          "nachrichten": "DLF",
          "80er": "AbsolutRelax",
          "90er": "BigFM"
        } %}{{ genre_map.get(radio_genre, "SWR3") }}
  - service: media_player.play_media
    target:
      entity_id: media_player.vaca_362812d56_mediaplayer
    data:
      media_content_type: music
      media_content_id: >
        {% set genre_streams = {
          "rock": "https://streams.radiobob.de/bob-live/mp3-192/mediaplayer",
          "pop": "https://liveradio.swr.de/sw282p3/swr3/play.mp3",
          "jazz": "https://stream.srg-ssr.ch/m/rsj/mp3_128",
          "klassik": "https://stream.klassikradio.de/live/mp3-192/stream.mp3",
          "chill": "https://stream.lounge.fm/",
          "electronic": "https://stream.sunshine-live.de/live/mp3-192/stream.mp3",
          "nachrichten": "https://st01.sslstream.dlf.de/dlf/01/128/mp3/stream.mp3",
          "80er": "https://stream.absolutradio.de/absolut-relax/mp3-192/stream.mp3",
          "90er": "https://streams.bigfm.de/bigfm-deutschland-128-mp3"
        } %}{{ genre_streams.get(radio_genre, "https://liveradio.swr.de/sw282p3/swr3/play.mp3") }}
  - service: view_assist.navigate
    data:
      device: sensor.quasselbuechse
      path: /view-assist/music
      revert_timeout: 3600
  speech:
    text: >
      {% set genre_display = {
        "rock": "Rock Radio (Radio Bob)",
        "pop": "Pop Radio (SWR 3)",
        "jazz": "Jazz Radio (Swiss Jazz)",
        "klassik": "Klassik Radio",
        "chill": "Lounge FM",
        "electronic": "Sunshine Live",
        "nachrichten": "Deutschlandfunk",
        "80er": "80er Radio (Absolut Relax)",
        "90er": "90er Radio (Big FM)"
      } %}
      {% set name = genre_display.get(radio_genre, radio_genre ~ " Radio") %}
      {% set responses = [
        "OK, " ~ name ~ " läuft.",
        "Alles klar, " ~ name ~ " wird gestartet.",
        name ~ " kommt."
      ] %} {{ responses | random }}

RadioPlayDefault:
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.spotify_ducking_active
  - service: media_player.play_media
    target:
      entity_id: media_player.vaca_362812d56_mediaplayer
    data:
      media_content_type: music
      media_content_id: >
        {% set last = states('input_text.radio_current_station') %}
        {% set stations = {
          "SWR3": "https://liveradio.swr.de/sw282p3/swr3/play.mp3",
          "SWR1": "https://liveradio.swr.de/sw282p3/swr1bw/play.mp3",
          "SWR2": "https://liveradio.swr.de/sw282p3/swr2/play.mp3",
          "WDR2": "https://wdr-wdr2-rheinland.icecastssl.wdr.de/wdr/wdr2/rheinland/mp3/128/stream.mp3",
          "1LIVE": "https://wdr-1live-live.icecastssl.wdr.de/wdr/1live/live/mp3/128/stream.mp3",
          "WDR5": "https://wdr-wdr5-live.icecastssl.wdr.de/wdr/wdr5/live/mp3/128/stream.mp3",
          "Bayern3": "https://streams.br.de/bayern3_2.m3u8",
          "Bayern1": "https://streams.br.de/bayern1_2.m3u8",
          "NDR2": "https://www.ndr.de/resources/metadaten/audio_ssl/livestream/ndr2.m3u",
          "HR3": "https://hr-hr3-live.sslcast.addradio.de/hr/hr3/live/mp3/128/stream.mp3",
          "AntenneBayern": "https://stream.antenne.de/antenne/stream/mp3",
          "RadioBob": "https://streams.radiobob.de/bob-live/mp3-192/mediaplayer",
          "RockAntenne": "https://stream.rockantenne.de/rockantenne/stream/mp3",
          "SunshineLive": "https://stream.sunshine-live.de/live/mp3-192/stream.mp3",
          "Fritz": "https://dispatcher.rndfnk.com/rbb/fritz/live/mp3/mid",
          "DLF": "https://st01.sslstream.dlf.de/dlf/01/128/mp3/stream.mp3",
          "DLFKultur": "https://st02.sslstream.dlf.de/dlf/02/128/mp3/stream.mp3",
          "Energy": "https://frontend.2.static.ert.hd-livestream.de/out/swr/swr_s01/default/11/hls/index_1.m3u8",
          "BigFM": "https://streams.bigfm.de/bigfm-deutschland-128-mp3",
          "KlassikRadio": "https://stream.klassikradio.de/live/mp3-192/stream.mp3",
          "Radio7": "https://stream.radio7.de/radio7/mp3-128/stream.mp3",
          "OE3": "https://orf-live.ors-shoutcast.at/oe3-q2a",
          "FIP": "https://icecast.radiofrance.fr/fip-midfi.mp3",
          "SwissJazz": "https://stream.srg-ssr.ch/m/rsj/mp3_128",
          "LoungeFM": "https://stream.lounge.fm/",
          "AbsolutRelax": "https://stream.absolutradio.de/absolut-relax/mp3-192/stream.mp3",
          "PlanetRadio": "https://planetradio.streamabc.net/planetradio-hqlivestream-mp3"
        } %}{{ stations.get(last, stations["SWR3"]) }}
  - service: view_assist.navigate
    data:
      device: sensor.quasselbuechse
      path: /view-assist/music
      revert_timeout: 3600
  speech:
    text: >
      {% set last = states('input_text.radio_current_station') %}
      {% set display_names = {
        "SWR3": "SWR 3", "SWR1": "SWR 1", "SWR2": "SWR 2",
        "WDR2": "WDR 2", "1LIVE": "1Live", "WDR5": "WDR 5",
        "Bayern3": "Bayern 3", "Bayern1": "Bayern 1", "NDR2": "NDR 2",
        "HR3": "HR 3", "AntenneBayern": "Antenne Bayern",
        "RadioBob": "Radio Bob", "RockAntenne": "Rock Antenne",
        "SunshineLive": "Sunshine Live", "Fritz": "Fritz",
        "DLF": "Deutschlandfunk", "DLFKultur": "Deutschlandfunk Kultur",
        "Energy": "Energy", "BigFM": "Big FM",
        "KlassikRadio": "Klassik Radio", "Radio7": "Radio 7",
        "OE3": "Ö 3", "FIP": "FIP", "SwissJazz": "Swiss Jazz",
        "LoungeFM": "Lounge FM", "AbsolutRelax": "Absolut Relax",
        "PlanetRadio": "Planet Radio"
      } %}
      {% if last and last != 'unknown' and last != '' %}
        {% set name = display_names.get(last, last) %}
        {% set responses = [
          "OK, " ~ name ~ " läuft wieder.",
          "Alles klar, " ~ name ~ " geht weiter."
        ] %} {{ responses | random }}
      {% else %}
        {% set responses = [
          "OK, SWR 3 läuft.",
          "Alles klar, ich starte SWR 3."
        ] %} {{ responses | random }}
      {% endif %}

RadioStop:
  action:
  - service: media_player.media_stop
    target:
      entity_id: media_player.vaca_362812d56_mediaplayer
    continue_on_error: true
  - service: view_assist.navigate
    data:
      device: sensor.quasselbuechse
      path: /view-assist/clock
  speech:
    text: >
      {% set responses = [
        "OK, Radio ist aus.",
        "Radio gestoppt.",
        "Alles klar, Radio beendet."
      ] %} {{ responses | random }}

RadioVolumeSet:
  action:
  - service: media_player.volume_set
    target:
      entity_id: media_player.vaca_362812d56_mediaplayer
    data:
      volume_level: "{{ volume_level | float / 100.0 }}"
  speech:
    text: "Lautstärke auf {{ volume_level }} Prozent."

RadioVolumeUp:
  action:
  - service: media_player.volume_set
    target:
      entity_id: media_player.vaca_362812d56_mediaplayer
    data:
      volume_level: >
        {{ [((state_attr('media_player.vaca_362812d56_mediaplayer', 'volume_level') or 0.5) + 0.1), 1.0] | min }}
  speech:
    text: >
      {% set vol = [((state_attr('media_player.vaca_362812d56_mediaplayer', 'volume_level') or 0.5) + 0.1), 1.0] | min %}
      Lauter. {{ (vol * 100) | int }} Prozent.

RadioVolumeDown:
  action:
  - service: media_player.volume_set
    target:
      entity_id: media_player.vaca_362812d56_mediaplayer
    data:
      volume_level: >
        {{ [((state_attr('media_player.vaca_362812d56_mediaplayer', 'volume_level') or 0.5) - 0.1), 0.0] | max }}
  speech:
    text: >
      {% set vol = [((state_attr('media_player.vaca_362812d56_mediaplayer', 'volume_level') or 0.5) - 0.1), 0.0] | max %}
      Leiser. {{ (vol * 100) | int }} Prozent.

RadioNowPlaying:
  speech:
    text: >
      {% set station = states('input_text.radio_current_station') %}
      {% set mp_state = states('media_player.vaca_362812d56_mediaplayer') %}
      {% set display_names = {
        "SWR3": "SWR 3", "SWR1": "SWR 1", "SWR2": "SWR 2",
        "WDR2": "WDR 2", "1LIVE": "1Live", "WDR5": "WDR 5",
        "Bayern3": "Bayern 3", "Bayern1": "Bayern 1", "NDR2": "NDR 2",
        "HR3": "HR 3", "AntenneBayern": "Antenne Bayern",
        "RadioBob": "Radio Bob", "RockAntenne": "Rock Antenne",
        "SunshineLive": "Sunshine Live", "Fritz": "Fritz",
        "DLF": "Deutschlandfunk", "DLFKultur": "Deutschlandfunk Kultur",
        "Energy": "Energy", "BigFM": "Big FM",
        "KlassikRadio": "Klassik Radio", "Radio7": "Radio 7",
        "OE3": "Ö 3", "FIP": "FIP", "SwissJazz": "Swiss Jazz",
        "LoungeFM": "Lounge FM", "AbsolutRelax": "Absolut Relax",
        "PlanetRadio": "Planet Radio"
      } %}
      {% if station and station != 'unknown' and station != '' and mp_state == 'playing' %}
        {% set name = display_names.get(station, station) %}
        Gerade läuft {{ name }}.
      {% elif station and station != 'unknown' and station != '' %}
        {% set name = display_names.get(station, station) %}
        Zuletzt lief {{ name }}, aber das Radio ist gerade aus.
      {% else %}
        Es läuft gerade kein Radio.
      {% endif %}

RadioList:
  speech:
    text: >
      Ich habe folgende Sender: SWR 1, SWR 2, SWR 3, WDR 2, 1Live, WDR 5,
      Bayern 1, Bayern 3, NDR 2, HR 3, Antenne Bayern, Radio Bob, Rock Antenne,
      Sunshine Live, Fritz, Deutschlandfunk, Energy, Big FM, Klassik Radio,
      Radio 7, Ö 3, Lounge FM, Swiss Jazz und noch mehr.
      Du kannst auch ein Genre sagen, zum Beispiel: Spiele Rock Radio.
